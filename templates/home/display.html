{% extends "layouts/base.html" %}
{% block content %}
<body style="background-color: {{ colors[0] }};"></body>
<div>
    <h3>Display Page</h3>
    
    <div class="container">
        <div class="row">
            <div class="col-auto">
                <div id="html-display">
                    <p>This is a html :\)</p>
                </div>
            </div>
            <div class="col-auto">
                <div id="image-display">
                    <img src="https://via.placeholder.com/150" alt="Image Display">
                </div>
            </div>
            <div class="col-auto">
                <div id="weblink-display">
                    <iframe src="https://iframetester.com" title="Weblink Display" frameborder="0"></iframe>
                </div>
            </div>
            <div class="col">
                <div id="qrcode-display"></div>
            </div>
        </div>

        
            <div class="progress" role="progressbar" aria-label="Progress Bar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="height: 1px;">
                <div id="progress-bar" class=" bg-success progress-bar progress-bar-striped progress-bar-animated"></div>
              </div>
        


    </div>

</div>

<script>
    var allPosts = {{ posts|tojson }};
    var colors = {{ colors|tojson }};
    var currentPostIndex = 0;

    function fetchNewPosts() {
        // Reload the page
        window.location.reload();
    }

    function displayPost(post, color) {
        console.log(`Displaying post ${post.id} of type ${post.type} with display time of ${post.display_time}`);
        document.body.style.backgroundColor = color;

        // Hide all display elements
        hideAllDisplayElements();

        // Display the post based on its type
        if (post.type.toLowerCase() === "html") {
            displayHTML(post.html_content);
        } else if (post.type.toLowerCase() === "image") {
            displayImage(post.image_link);
        } else if (post.type.toLowerCase() === "weblink") {
            displayWeblink(post.web_link);
        } else {
            console.log(`Error: Post type ${post.type} not found`);
        }

        // Calculate the next post index
        currentPostIndex = (currentPostIndex + 1) % allPosts.length;

        // Set a timeout to display the next post after a delay
        setTimeout(function () {
            displayPost(allPosts[currentPostIndex], colors[currentPostIndex]);
        }, post.display_time * 1000); // Convert display_time to milliseconds
    }

    function hideAllDisplayElements() {
        var elements = ["html-display", "image-display", "weblink-display", "qrcode-display"];
        elements.forEach(function (elementId) {
            toggleDisplayElementVisibility(elementId, false);
        });
    }

    function toggleDisplayElementVisibility(elementId, display) {
        var element = document.getElementById(elementId);
        if (element) {
            element.style.display = display ? "block" : "none";
        }
    }

    function displayHTML(htmlContent) {
        var htmlDisplay = document.getElementById("html-display");
        if (htmlDisplay) {
            htmlDisplay.innerHTML = htmlContent;
            toggleDisplayElementVisibility("html-display", true);
        }
    }

    function displayImage(imagePath) {
        var imageDisplay = document.getElementById("image-display");
        if (imageDisplay) {
            imageDisplay.innerHTML = `<img src="${imagePath}" alt="Image Display">`;
            toggleDisplayElementVisibility("image-display", true);
        }
    }

    function displayWeblink(webLinkPath) {
        var weblinkDisplay = document.getElementById("weblink-display");
        if (weblinkDisplay) {
            weblinkDisplay.innerHTML = `<iframe src="${webLinkPath}" title="Weblink Display" frameborder="0"></iframe>`;
            toggleDisplayElementVisibility("weblink-display", true);
        }
    }

    document.addEventListener("DOMContentLoaded", function (event) {
        displayPost(allPosts[currentPostIndex], colors[currentPostIndex]);
    });

</script>

{% endblock %}