<!DOCTYPE html>
<html>
<head>
    <title>Image Display</title>
    <style>
        .centered-image {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 80vh;
            padding: 20px;
        }

        #imageDisplay {
            max-width: 100%;
            max-height: 100%;
        }

        #websiteIframe {
            width: 80vw;
            height: 60vh;
            border: none;
        }

        #qrCodeImage {
            max-width: 100%;
            max-height: 60vh; 
        }
    </style>
</head>
<body>
    <div class="centered-image">
        <iframe id="websiteIframe" src="about:blank"></iframe>
        <img id="imageDisplay" src="" alt="">
    </div>
    <script>
        var imageElement = document.getElementById('imageDisplay');
        var websiteIframe = document.getElementById('websiteIframe');
        var filenames = {{ filenames | tojson | safe }}; // Gets the filenames from flask
        var display_times = {{ display_times | tojson | safe }}; // Gets the associated display tiems from flask
        var currentImageIndex = 0;
        var interval = null;
    
        function displayNextImage() {
            var imageName = filenames[currentImageIndex];
            var imageUrl = '/static/images/' + imageName;
            imageElement.src = '';
            websiteIframe.src = 'about:blank'; // initializing all of the html elemnts
           
            if (imageName.includes('qr')) {
                var fname = imageName.split('qr.jpg')[0];
                var websiteName = fname.split('_')[1];
                websiteIframe.src = 'https://' + websiteName; // website url from file name

                var qrCodeImage = document.createElement('img'); // create qr code image
                qrCodeImage.id = 'qrCodeImage';
                qrCodeImage.src = imageUrl; 

                var container = document.querySelector('.centered-image');  // Find the container element with the class 'centered-image'


                
                var existingQrCodeImage = document.getElementById('qrCodeImage');
                if (existingQrCodeImage) {
                    container.removeChild(existingQrCodeImage);// remove the QR code if it exixts already
                }

                container.appendChild(qrCodeImage); // add it if it doesn't
            } else {
                // hide the QR code image if it's not a QR code
                var qrCodeImage = document.getElementById('qrCodeImage');
                if (qrCodeImage) {
                    qrCodeImage.style.display = 'none'; // hide the qr code after displayed
                }

                imageElement.src = imageUrl; 
            }
            
            if (imageName.includes('.txt')) {
                var fname = imageName.split('txt')[0];
                var websiteName = fname.split('_')[1];
                websiteIframe.src = 'https://' + websiteName; 
            }
    
            currentImageIndex = (currentImageIndex + 1) % filenames.length; // get the new image
            var currentTime = display_times[currentImageIndex]; // Get the new time
    
            
            clearInterval(interval); // stop the timer 
            interval = setInterval(displayNextImage, currentTime); //  displays the image for a certain amnt of time
        }
    
        displayNextImage();
    </script>
    
</body>
</html>